# Led - DBS2 Plugin
発車標２ (DBS2) 用のLED表示を再現するプラグインのソースです。  
このプラグインのパッケージ、DBS2のダウンロードは学内向けサイトからお願いします。

## 学外の方へ
申し訳ございませんが、DBS2のダウンロードが学内の方のみ可能のため、現在このリポジトリは実質学内専用となっております。  
時が来たらDBS2本体もパブリックにダウンロードを可能にする予定ですので、しばらくお待ち下さい。  
（実はDBS2本体が無くとも少し弄ればWPF上で使用出来てしまうのですが、そういった使い方ももう少し待って頂けると嬉しいです……）

## 概要
編集中…

## このリポジトリをローカルで実行するには
DBS2 本体の参照が必要ですので、本体をダウンロードの上、VS上で参照を追加して下さい。

## プラグインが Converter を読み込む手順
IVisibilityConverterを実装したクラスをユーザーが作成することで、各パーツの表示・非表示のタイミングを詳細に設定することが出来るようにしてあります。

### １．（ユーザーサイド）コードを書く
各 Converter を実装する C# コードを**テキストファイル**に書いておきます。事前のコンパイルは不要です。

### ２．コードファイルを読み込む
LED パーツファイルの記述に従って、Converterのコードが書かれたテキストファイルを読み込みます。

### ３．コンパイルする
テキストファイルをコンパイルします。参照アセンブリにはLed.PartDefinitionをDBS2の一時フォルダ（/Plugin/Temp）にコピーしたものが追加されます。  
コンパイルには、DBS2からプラグインの初期化時に提供されるDbsPluginConnectorクラスに含まれるCompileAssemblyメソッドを使用しています。

### ４．インスタンスを作成する
コンパイルしたものをアセンブリとして読み込み、インスタンスを作成してプラグインから使用出来るようにします。

## プロジェクトの構成
### Led
メインのプロジェクトです。DBS2のプラグインとして使用するために必要なDbsPluginBase抽象クラスの実装はこのプロジェクトにあります。

### Led.PartDefinition
LEDパーツ関連のクラス・構造体の定義のみが入ったプロジェクトです。各種Converterから参照される部分のみを別アセンブリに分離させることが目的です。

### Led.Calculation
重い演算部分のみを分離してUnmanaged C++で書いたものです。

## ライセンス関係
このリポジトリは２条項BSDライセンスで公開しています。
このプラグインに含まれる[Prism Library](https://prismlibrary.com/)は、[Apache 2.0 ライセンス](http://www.apache.org/licenses/LICENSE-2.0)で配布されています。